<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Runway Slots Inquiry</title>
  <link rel="stylesheet" href="styles/manualscr.css">
  <link rel="stylesheet" href="styles/navi-ui.css">
</head>
<body>
  <nav>
    <ul>
      <li><a href="index.html">Home</a></li>
      <li><a href="multiflight.html">Multi Flight</a></li>
      <li><a href="airport-search.html">Airport Database</a></li>
      <li><a href="gcrformat.html">GCR Format</a></li>
      <li><a href="turnaround.html">Turnaround Format</a></li>
      <li><a href="quicklinks.html">Quick Links</a></li>
      <li><a href="https://forms.gle/nXCQzWxCcH5B1uZd6">Log Issues</a></li>
    </ul>
  </nav>

  <div class="container">
    <div class="title-bar">Runway Slots Inquiry</div>
    <div class="window-content">
      <div class="btn-group">
        <button type="button" onclick="addSirForm()">Create SIR</button>
        <button id="backToTop" type="button" onclick="scrollToTop()">Back to Top</button>
      </div>

      <div id="formsContainer"></div>

      <div id="logContainer" class="log-section" style="display: none;">
        <h3>Message Log</h3>
        <table id="logTable">
          <thead>
            <tr>
              <th>Action</th>
              <th>Details</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        <button type="button" onclick="downloadCSV()">Download CSV</button>
      </div>
    </div>
  </div>

  <!-- SIR FORM TEMPLATE -->
  <template id="sirTemplate">
    <div class="sir-form">
      <button class="remove-btn" type="button" onclick="removeForm(this)">Remove Form</button>
      <h3>Runway Slot Inquiry</h3>
      <div class="form-group">
        <label>Airport Name:</label>
        <input type="text" class="airportName" placeholder="e.g. DUB">
      </div>
      <div class="form-group">
        <label>Start Date:</label>
        <input type="date" class="startDate">
      </div>
      <div class="form-group">
        <label>End Date:</label>
        <input type="date" class="endDate">
      </div>
      <div class="form-group">
        <label>Flight Number 1:</label>
        <input type="text" class="flight1" placeholder="e.g. FR123">
      </div>
      <div class="form-group">
        <label>Flight Number 2:</label>
        <input type="text" class="flight2" placeholder="e.g. FR456">
      </div>
      <div class="btn-group" style="justify-content: flex-start;">
        <button type="button" onclick="findRunwaySlots(this.closest('.sir-form'))">Find Slots</button>
      </div>
      <!-- Use <pre> to preserve line breaks exactly -->
      <pre class="sirOutput output-container" style="white-space: pre-wrap;"></pre>
    </div>
  </template>

  <footer>Created By: ArtemisByte</footer>
  <footer>Disclaimer:
    Use of this Service is at your own risk. The creator provides this Service "as is" without any warranties and is not liable for any damages or losses resulting from its use. You assume all responsibility.
  </footer>

  <script>
    function addSirForm() {
      const tpl = document.getElementById('sirTemplate');
      const clone = tpl.content.cloneNode(true);
      document.getElementById('formsContainer').appendChild(clone);
    }

    function removeForm(btn) {
      btn.parentNode.remove();
    }

    function findRunwaySlots(form) {
      const airport = form.querySelector('.airportName').value.trim();
      const start = form.querySelector('.startDate').value.replace(/-/g, '').slice(6,8) + 'JUL';
      const end = form.querySelector('.endDate').value.replace(/-/g, '').slice(6,8) + 'JUL';
      const f1 = form.querySelector('.flight1').value.trim();
      const f2 = form.querySelector('.flight2').value.trim();
      
      // Current date in DDMMM format
      const now = new Date();
      const day = String(now.getDate()).padStart(2, '0');
      const monthNames = ["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"];
      const mon = monthNames[now.getMonth()];
      const currentDate = `${day}${mon}`;
      
      // Build SIR output with explicit line breaks
      let output = `SIR \nS25\n${currentDate}\n${airport}`;
      if (f1) output += `\nQ${f1} ${start}${end}`;
      if (f2) output += `\nQ${f2} ${start}${end}`;
      output += `\n SI SIR REQUEST`;
      
      form.querySelector('.sirOutput').textContent = output;
      
      // Log the inquiry
      document.getElementById('logContainer').style.display = 'block';
      const row = document.createElement('tr');
      row.innerHTML = `<td>INQUIRY</td><td>${output.replace(/\n/g, ' | ')}</td>`;
      document.querySelector('#logTable tbody').appendChild(row);
    }

    function scrollToTop() {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
  </script>
</body>
</html>
